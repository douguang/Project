#!/usr/bin/env python
# -*- coding: UTF-8 -*-
'''
Author      : Dong Junshuang
Description : 世界之树
'''
from utils import hql_to_df, update_mysql
import settings
from pandas import DataFrame
from get_equip_info import get_equip_df

if __name__ == '__main__':
    settings.set_env('superhero_bi')
    sql ='''
    SELECT uid,
           args
    FROM raw_action_log
    WHERE action='world_tree.buy'
      AND ds >= '20160701'
      AND ds <= '20160704'
      AND substr(uid,1,1) = 'g'
    '''
    word_df = hql_to_df(sql)
    uid_list = ['g562645689',
'g5080305174',
'g161528442',
'g2382331780',
'g4964357564',
'g4695570338',
'g4949720607',
'g5017400035',
'g5079693492',
'g433241595',
'g4606874186',
'g5129288108',
'g5075209132',
'g5133452835',
'g5121216789',
'g5121844458',
'g4266218250',
'g335874122',
'g213098586',
'g5053610690',
'g5113184267',
'g5034795029',
'g4947770377',
'g5056570086',
'g443601383',
'g5151395049',
'g546628981',
'g5120027932',
'g5143455501',
'g5113807739',
'g5028748570',
'g68335124',
'g5141575053',
'g4604131081',
'g5130587608',
'g5146839112',
'g775046331',
'g888736901',
'g5059062624',
'g5147742791',
'g4678640137',
'g2101133444',
'g678799605',
'g567389478',
'g4730232023',
'g4493382786',
'g918841459',
'g489245716',
'g4905854067',
'g5104169162',
'g390443017',
'g4928773205',
'g822122789',
'g5105628890',
'g3975651899',
'g5017666961',
'g5075187179',
'g515929260',
'g5078769149',
'g5134630221',
'g4260403854',
'g5096193820',
'g489627993',
'g5154390518',
'g1359943412',
'g4938891031',
'g217114141',
'g4851629672',
'g5132777741',
'g5113549567',
'g448030465',
'g5134565841',
'g3095110185',
'g5065151238',
'g3328070691',
'g225088099',
'g379528026',
'g5127138000',
'g4444764886',
'g61329598',
'g37090414',
'g5143744542',
'g66933757',
'g5033722598',
'g5083689208',
'g1202050620',
'g4981603603',
'g5115309845',
'g2548817293',
'g139830570',
'g5038319136',
'g3587007152',
'g2728016230',
'g810458583',
'g1033958050',
'g5159792982',
'g4888651468',
'g4890309064',
'g755980496',
'g2641542987',
'g3342020571',
'g5137762409',
'g1908027764',
'g5040100825',
'g5069639949',
'g4914173747',
'g2743061757',
'g4688016211',
'g2111920144',
'g1736312266',
'g5128126370',
'g5156174696',
'g5010144405',
'g4889633792',
'g389649154',
'g3656300835',
'g4912169825',
'g5148012757',
'g5084220000',
'g548048576',
'g468793459',
'g5005134540',
'g5141230175',
'g1695689977',
'g204976396',
'g4824825882',
'g5143040813',
'g670000778',
'g5111229059',
'g5120444234',
'g3785761285',
'g609458775',
'g1459476418',
'g1397638343',
'g2570135200',
'g5131491453',
'g990595744',
'g62187049',
'g4921466066',
'g4965798282',
'g4889790837',
'g1185993604',
'g4856347819',
'g4633992875',
'g860991945',
'g1838664437',
'g4929283929',
'g5065000690',
'g4255682930',
'g4855458449',
'g5132636496',
'g923572213',
'g580115092',
'g5096546871',
'g1371457711',
'g562118990',
'g386883646',
'g5013613677',
'g4042688818',
'g4692149302',
'g1424299476',
'g2236881977',
'g64714171',
'g1116434557',
'g1741088877',
'g3554261368',
'g5116205655',
'g3478601657',
'g4652614210',
'g1475872220',
'g1409681897',
'g5038049007',
'g5024223546',
'g5151099673',
'g600582633',
'g413913548',
'g5067132813',
'g255546507',
'g5050319100',
'g67287771',
'g255833358',
'g5150032489',
'g1099342159',
'g5010764761',
'g2409462760',
'g4273215484',
'g1959532993',
'g121062682',
'g911228171',
'g5157947965',
'g3879389286',
'g3964739700',
'g570813948',
'g510905691',
'g5031610183',
'g2444208458',
'g1455581771',
'g5122218932',
'g5079343847',
'g5151690242',
'g60779738',
'g360370735',
'g4572748434',
'g209209083',
'g1853821975',
'g5065951699',
'g1315069773',
'g3762233632',
'g5074158315',
'g48914985',
'g502375157',
'g4764224099',
'g4714639689',
'g5057720766',
'g5125909144',
'g700602973',
'g5128756327',
'g5117150740',
'g3547804835',
'g3183523792',
'g4735198568',
'g507885865',
'g499603035',
'g5036715752',
'g5078680342',
'g1153854001',
'g5156872500',
'g5158322246',
'g2318785741',
'g3530893644',
'g5120822364',
'g110979141',
'g5047360914',
'g643734172',
'g344331525',
'g4545070035',
'g1319522191',
'g5079076598',
'g378076065',
'g893463181',
'g5073826012',
'g2590373367',
'g336656592',
'g5157669799',
'g4602823090',
'g5146782719',
'g204495162',
'g4002893411',
'g4799602759',
'g5110138465',
'g5136772757',
'g3018188103',
'g188629818',
'g209083512',
'g5135516680',
'g4522313411',
'g67474303',
'g4696611468',
'g210590311',
'g5014733997',
'g4859069114',
'g304138586',
'g490299509',
'g3459326138',
'g5097991988',
'g624692891',
'g2519988559',
'g5144134970',
'g5004258627',
'g3007822045',
'g332633141',
'g4678888473',
'g73920281',
'g3564386891',
'g1859878033',
'g4991156456',
'g5053409879',
'g222353238',
'g4956179031',
'g5142024197',
'g5149374646',
'g3129844140',
'g5072226940',
'g4569802571',
'g630912164',
'g5079598846',
'g5149153433',
'g69532745',
'g4333499491',
'g5116108732',
'g5133795031',
'g63460810',
'g4793746717',
'g196620630',
'g1283979735',
'g4011025449',
'g199652831',
'g5079996094',
'g961413053',
'g2164195973',
'g1064725149',
'g2875738977',
'g4280151350',
'g5146632482',
'g163500602',
'g3556848864',
'g655914153',
'g5139747764',
'g261328244',
'g564154156',
'g4756469385',
'g4492164693',
'g331770546',
'g5034248648',
'g60142527',
'g691293568',
'g252128228',
'g4824045071',
'g1503260872',
'g5129533556',
'g4445663979',
'g1107250960',
'g4841418543',
'g1976153505',
'g5107501602',
'g5103766110',
'g3105660354',
'g5001787774',
'g1644799640',
'g1099077802',
'g1697510917',
'g119211934',
'g5069922180',
'g4992485058',
'g159292255',
'g4967032577',
'g5058025327',
'g5018312024',
'g4891385838',
'g4880880567',
'g4854250678',
'g221486215',
'g4771654481',
'g3294176541',
'g5147617861',
'g4581939079',
'g3819836277',
'g5130961631',
'g5065567659',
'g4498680930',
'g5139625889',
'g5056260727',
'g5067893550',
'g63033582',
'g5110372754',
'g1183007570',
'g5110288512',
'g5088225712',
'g4490909042',
'g5000193041',
'g2266828786',
'g5113274018',
'g62591105',
'g353899595',
'g64653066',
'g4750608675',
'g922922040',
'g5029053757',
'g5144178374',
'g5047112524',
'g4973056153',
'g5053977603',
'g2722447173',
'g4625454329',
'g61354805',
'g68324607',
'g4808951932',
'g4512507631',
'g3907336987',
'g5031060124',
'g3857936916',
'g4925175500',
'g954778640',
'g286476212',
'g63487107',
'g5147296188',
'g5088001915',
'g5012835470',
'g4654300740',
'g4747963343',
'g367610766',
'g1379287035',
'g4912188638',
'g5034268813',
'g4679013639',
'g5148249975',
'g1451579715',
'g1630020909',
'g5075845023',
'g4572226526',
'g4744404179',
'g4735061179',
'g5144999542',
'g4966615188',
'g4541973375',
'g5108525041',
'g5081879752',
'g3362621699',
'g5158663942',
'g1951291103',
'g112665713',
'g4974902256',
'g4951802907',
'g4700914917',
'g5055485289',
'g1332775707',
'g363470078',
'g168505113',
'g919489375',
'g4586710550',
'g4866844964',
'g5043075342',
'g5122433950',
'g4540864397',
'g5112321787',
'g4683697270',
'g4910828974',
'g4952469253',
'g4614387721',
'g5089770707',
'g4722230233',
'g1202866613',
'g119313436',
'g1909837597',
'g4951289287',
'g1609205929',
'g5022090072',
'g84789457',
'g5130348454',
'g4407111963',
'g2128758535',
'g5157550494',
'g4593784088',
'g4588139533',
'g5014034950',
'g3787323701',
'g4780169090',
'g696568628',
'g2508969621',
'g5118907565',
'g5089326249',
'g5028431664',
'g1114151336',
'g1139553714',
'g4767013702',
'g2713561663',
'g5007071059',
'g400052454',
'g5024214010',
'g45036699',
'g5133376807',
'g4565616520',
'g751727342',
'g5146763636',
'g4501656944',
'g65738662',
'g214694023',
'g5144482607',
'g5122010956',
'g5020631154',
'g5035645944',
'g287211606',
'g5102973620',
'g1398034468',
'g3214009149',
'g4958178175',
'g5149906700',
'g5086307899',
'g661106632',
'g5146157157',
'g4738447042',
'g4475275214',
'g113672799',
'g5038244906',
'g5011671027',
'g1300211722',
'g5157221881',
'g5091988997',
'g1002502951',
'g1246478693',
'g2199286077',
'g110913204',
'g4498768176',
'g5081110566',
'g5087741727',
'g4426663161',
'g5146264639',
'g780604645',
'g4656294283',
'g3391198202',
'g5152992260',
'g4956932778',
'g1504599773',
'g1904633812',
'g832180216',
'g5129910378',
'g2053545965',
'g239820789',
'g5134436368',
'g5145466180',
'g5123555764',
'g2138372611',
'g4986501819',
'g5145884043',
'g4540828690',
'g5052381866',
'g5145838643',
'g3743642119',
'g61432897',
'g4876337423',
'g5101325866',
'g5075196859',
'g3359732013',
'g5079464037',
'g3876431023',
'g347557404',
'g5111705805',
'g677197819',
'g4660873238',
'g237757446',
'g106079119',
'g5069089437',
'g937413401',
'g454198121',
'g594176657',
'g332965957',
'g5129125709',
'g4879340732',
'g3823773617',
'g68585777',
'g109915887',
'g5046661300',
'g4938529812',
'g3545534668',
'g61899364',
'g852469517',
'g4733962849',
'g371699135',
'g91395578',
'g4970759038',
'g4968713357',
'g4608903701',
'g929733119',
'g714818400',
'g63885516',
'g202317633',
'g5148773648',
'g412384095',
'g67264575',
'g441238191',
'g337826622',
'g4653971074',
'g5115472275',
'g453330997',
'g4975709259',
'g187828774',
'g4932070037',
'g5017506280',
'g4555830805',
'g5101022559',
'g393256655',
'g3185672565',
'g268292292',
'g5131155791',
'g3238567247',
'g4789238898',
'g167869478',
'g5150094976',
'g4650953792',
'g1535492167',
'g5074112626',
'g4616306693',
'g233179732',
'g250656693',
'g529843514',
'g5125576291',
'g5115496953',
'g3719602186',
'g5106234558',
'g4984303563',
'g4810256770',
'g4741921324',
'g125940081',
'g5029872904',
'g306295030',
'g5149360569',
'g5075287480',
'g550504645',
'g4834553687',
'g113997279',
'g446388941',
'g2061092238',
'g923208546',
'g512808307',
'g3160960662',
'g507764604',
'g4792496348',
'g5124214668',
'g4975290396',
'g5114945772',
'g4884362400',
'g4899685803',
'g395414225',
'g87436702',
'g3907133572',
'g5093709312',
'g5109565962',
'g982254655',
'g2191146929',
'g1200466609',
'g5126633661',
'g283505891',
'g3062372094',
'g5113699290',
'g49358739',
'g63366051',
'g3254945856',
'g3679433306',
'g63071474',
'g4904042906',
'g3051953365',
'g5144070143',
'g5053751091',
'g5151430851',
'g4474961328',
'g484024981',
'g321277029',
'g5136542343',
'g1803567221',
'g695847416',
'g4722636225',
'g943894305',
'g5124681412',
'g5000144150',
'g4765122127',
'g1553226891',
'g62104597',
'g5080371809',
'g1417404982',
'g3288569339',
'g1025137875',
'g4494687705',
'g5139048895',
'g118241785',
'g633812017',
'g5109090187',
'g1882716034',
'g5100790174',
'g5087407027',
'g5027371059',
'g3455175363',
'g5106113209',
'g1665777125',
'g5121043763',
'g5068046914',
'g4954556695',
'g4164209290',
'g64399578',
'g4709978239',
'g954699863',
'g62896147',
'g5152718092',
'g33977249',
'g5053203310',
'g1889288685',
'g5149908269',
'g298947892',
'g206548439',
'g69010112',
'g5147396136',
'g2683553675',
'g5087681797',
'g4212315173',
'g3853006970',
'g184705943',
'g1100164015',
'g5077900567',
'g4696079127',
'g4913500552',
'g5140965970',
'g3974561512',
'g926728436',
'g3846800464',
'g5110166357',
'g5154880021',
'g819276472',
'g4995875162',
'g4743276065',
'g5018491057',
'g187951880',
'g5158062275',
'g3600547945',
'g5111176478',
'g5150411850',
'g5060325496',
'g4973488134',
'g928915710',
'g4557803381',
'g5111731202',
'g1560450885',
'g1921500427',
'g4143728214',
'g511635097',
'g5091370791',
'g5093066677',
'g4654535440',
'g4810608442',
'g5157866797',
'g98064473',
'g836047152',
'g64410700',
'g4551637236',
'g4820282003',
'g5044833409',
'g354659909',
'g225940213',
'g5113849440',
'g5018176094',
'g146352460',
'g4822371249',
'g5148785339',
'g5124582041',
'g4713354255',
'g407976763',
'g5103426835',
'g2013230718',
'g5022477985',
'g949463392',
'g61628898',
'g2694412056',
'g5113082592',
'g412298394',
'g958197671',
'g1882395495',
'g5113810387',
'g5110492448',
'g5086603644',
'g483516826',
'g2863285653',
'g4080488024',
'g2383325260',
'g4144170789',
'g4911498048',
'g3741466076',
'g4760278189',
'g4748446534',
'g5087218906',
'g2186757359',
'g5144818968',
'g5051992527',
'g5035729092',
'g5000970896',
'g4817851452',
'g63970451',
'g64883149',
'g5034037348',
'g67183015',
'g879107211',
'g4994321905',
'g5038857123',
'g4765288349',
'g1585761774',
'g5132673835',
'g68181947',
'g1241363728',
'g4140120992',
'g543155277',
'g5107860800',
'g4924410789',
'g5135643700',
'g1120384550']

word_df['is_uid'] = word_df['uid'].isin(uid_list)
result = word_df[word_df['is_uid']]
del result['is_uid']

uid_list,mm_list = [],[]
for i in range(len(result)):
    uid = result.iloc[i,0]
    args = result.iloc[i,1]
    args = eval(args)
    if args.has_key('goods_id'):
        # print args['goods_id']
        print args['goods_id'][0]
        uid_list.append(uid)
        mm_list.append(args['goods_id'][0])
    else:
        continue
data = DataFrame({'uid':uid_list,'goods_id':mm_list})
data['num'] =1
result_df = data.groupby(['uid','goods_id']).count().reset_index()
result_df = result_df.sort_values(by=['uid','goods_id'])
result_df.to_excel('/Users/kaiqigu/Downloads/Excel/word.xlsx')





